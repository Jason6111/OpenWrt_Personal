
#
#
# æ„Ÿè°¢p3terxå¤§ç¥çš„ä¸€é”®ç¼–è¯‘è„šæœ¬
# 
# Copyright (C) 2019 P3TERX <https://p3terx.com>
# <https://github.com/P3TERX/Actions-OpenWrt.git>
#


name: ç¼–è¯‘OpenWrtå›ºä»¶

on:
  workflow_dispatch:
    inputs:
      name:
        description: 'Person to greet'
        required: true
        default: 'build-openwrt'


#ç¼–è¾‘ä»»æ„æŒ‡å®šæ–‡ä»¶è§¦å‘å¼€å§‹ç¼–è¯‘
#  push:
#    branches:
#      - master
#    paths:
#      - 'å¼€å¯ç¼–è¯‘openwrt'


#å®šæ—¶è§¦å‘å¼€å§‹ç¼–è¯‘(å¼€å¯å®šæ—¶ç¼–è¯‘è¯·å…ˆç¡®å®šSSHå¤„åœ¨å…³é—­çŠ¶æ€,è¦ä¸ç„¶SSHæ²¡äººç®¡,ä¼šå¡SSHç¼–è¯‘å¤±è´¥)
#  schedule:
#    - cron: 0 8 */5 * *


#ç‚¹â˜†Starè§¦å‘å¼€å§‹ç¼–è¯‘
  watch:
#    types: started


env:
  REPO_TOKEN: ${{ secrets.REPO_TOKEN }}
  SCKEY: ${{ secrets.SCKEY }}
  GITHUB_RELEASE: https://github.com/281677160/Actions-OpenWrt/releases
  TZ: Asia/Shanghai

jobs: 
  build:
    runs-on: ubuntu-18.04
    if: github.event.repository.owner.id == github.event.sender.id

    name: ç¼–è¯‘ ${{matrix.target}}
    strategy:
      fail-fast: false
      matrix:
        target: [Lede_x86_64]  #[Lede_x86_64,Lede_redmi_ac2100,Lede_newifi_d2,Lede_phicomm_k2p,Lienol_x86_64,Lienol_phicomm_k2p,Lienol_phicomm_k3,Project_x86_64,Project_newifi_d2,Project_phicomm_k3]

    steps:
    - name: å‡†å¤‡ç»“æŸ
      uses: actions/checkout@v2
 
    - name: PUSHPLUSä¿¡æ¯é€šçŸ¥
      if: env.SERVERCHAN_SCKEY == 'true'
      run: |
        curl -k --data token="${{ secrets.PUSH_PLUS_TOKEN }}" --data title="å¼€å§‹ç¼–è¯‘ã€${{matrix.target}}ã€‘" --data "content=ğŸ‰ ä¸»äººï¼šæ‚¨æ­£åœ¨ä½¿ç”¨ã€${{matrix.target}}ã€‘æ–‡ä»¶å¤¹ç¼–è¯‘å›ºä»¶ä¸­(${{env.CangKu}}ä»“åº“çš„#${{env.Run_number}}å·),è¯·è€å¿ƒç­‰å¾…...... ğŸ˜‹ğŸ’" "http://www.pushplus.plus/send"
